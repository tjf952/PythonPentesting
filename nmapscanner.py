#!/usr/bin/env python3

"""Gathering Information

(1) Grabbing banners
(2) Hostname
(3) IP Lookup

Usage: $ python3 inforecon.py <url>

Arguments:
    -url <str>: url of website
"""

import json
import nmap
import sys


def nmap_scanner(target: str) -> str:
    """Scans 21,22,80,139,443,8080 of the target

    Args:
        target (str): The target to be scanned

    Returns:
        str: The nmap results of the target
    """
    ports = [21, 22, 80, 139, 443, 8080]
    try:
        scanner = nmap.PortScanner()
        print(f"[!] Scanning {target} for default ports...\n")
        for port in ports:
            portscan = scanner.scan(target, str(port))
            print(f"Port {port}:")
            ip = next(iter(portscan["scan"].keys()))
            state = portscan["scan"][ip]["tcp"][port]["state"]
            name = portscan["scan"][ip]["tcp"][port]["name"]
            if state == "open":
                print(json.dumps(portscan["scan"][ip]["tcp"][port], indent=2))
            else:
                print(f"  {state} - {name}")
    except Exception as e:
        print(f"Error: {e}")
        print("NMAP scan failed, exiting...")
        sys.exit(1)


if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(f"Usage: python3 {sys.argv[0]} <target>")
        sys.exit(1)
    nmap_scanner(sys.argv[1])
